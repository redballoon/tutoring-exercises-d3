/* global jQuery:true, d3:true */
jQuery(function ($) {
	'use strict';
	var options = {
			debug : true,
			graphWidth : 960,
			graphHeight : 500,
			format : '%Y-%m-%d %H:%M:%S',
			date : ['2016-03-18 15:59:58', '2016-03-21 14:10:02', '2016-03-21 14:20:02', '2016-03-21 14:30:02', '2016-03-23 15:39:47', '2016-03-23 15:39:58', '2016-03-23 15:40:02', '2016-03-23 15:40:12', '2016-03-23 15:50:02', '2016-03-23 16:00:04', '2016-03-23 16:10:04', '2016-03-23 16:20:01', '2016-03-23 16:30:02', '2016-03-23 16:40:03', '2016-03-23 16:50:02', '2016-03-23 17:00:02', '2016-03-23 17:10:02', '2016-03-23 17:20:02', '2016-03-23 17:30:02', '2016-03-23 17:40:02', '2016-03-23 17:50:02', '2016-03-23 18:00:02', '2016-03-23 18:10:03', '2016-03-23 18:20:02', '2016-03-23 18:30:02', '2016-03-23 18:40:02', '2016-03-23 18:50:02', '2016-03-23 19:00:01', '2016-03-23 19:10:02', '2016-03-23 19:20:03', '2016-03-23 19:30:02', '2016-03-23 19:40:02', '2016-03-23 19:50:02', '2016-03-23 20:00:02', '2016-03-23 20:10:02', '2016-03-23 20:20:02', '2016-03-23 20:30:03', '2016-03-23 20:40:01', '2016-03-23 20:50:02', '2016-03-23 21:00:02', '2016-03-23 21:10:02', '2016-03-23 21:20:02', '2016-03-23 21:30:02', '2016-03-23 21:40:02', '2016-03-23 21:50:02', '2016-03-23 22:00:03', '2016-03-23 22:10:02', '2016-03-23 22:20:03', '2016-03-23 22:30:02', '2016-03-23 22:40:02', '2016-03-23 22:50:01', '2016-03-23 23:00:02', '2016-03-23 23:10:01', '2016-03-23 23:20:02', '2016-03-23 23:30:02', '2016-03-23 23:40:01', '2016-03-23 23:50:02', '2016-03-24 00:00:01', '2016-03-24 00:10:02', '2016-03-24 00:20:02', '2016-03-24 00:30:02', '2016-03-24 00:40:02', '2016-03-24 00:50:02', '2016-03-24 01:00:05', '2016-03-24 01:10:02', '2016-03-24 01:20:02', '2016-03-24 01:30:02', '2016-03-24 01:40:02', '2016-03-24 01:50:02', '2016-03-24 02:00:02', '2016-03-24 02:10:02', '2016-03-24 02:20:05', '2016-03-24 02:30:03', '2016-03-24 02:40:03', '2016-03-24 02:50:03', '2016-03-24 03:00:03', '2016-03-24 03:10:02', '2016-03-24 03:20:03', '2016-03-24 03:30:04', '2016-03-24 03:40:06', '2016-03-24 03:50:02', '2016-03-24 04:00:02', '2016-03-24 04:10:02', '2016-03-24 04:20:02', '2016-03-24 04:30:02', '2016-03-24 04:40:02', '2016-03-24 04:50:02', '2016-03-24 05:00:02', '2016-03-24 05:10:02', '2016-03-24 05:20:02', '2016-03-24 05:30:03', '2016-03-24 05:40:02', '2016-03-24 05:50:02', '2016-03-24 06:00:03', '2016-03-24 06:10:02', '2016-03-24 06:20:02', '2016-03-24 06:30:02', '2016-03-24 06:40:02', '2016-03-24 06:50:02', '2016-03-24 07:00:02', '2016-03-24 07:10:02', '2016-03-24 07:20:02', '2016-03-24 07:30:02', '2016-03-24 07:40:02', '2016-03-24 07:50:02', '2016-03-24 08:00:02', '2016-03-24 08:10:02', '2016-03-24 08:20:02', '2016-03-24 08:30:02', '2016-03-24 08:40:02', '2016-03-24 08:50:02', '2016-03-24 09:00:02', '2016-03-24 09:10:02', '2016-03-24 09:20:08', '2016-03-24 09:30:02', '2016-03-24 09:40:02', '2016-03-24 09:50:02', '2016-03-24 10:00:02', '2016-03-24 10:10:02', '2016-03-24 10:20:01', '2016-03-24 10:30:02', '2016-03-24 10:40:02', '2016-03-24 10:50:03', '2016-03-24 11:00:02', '2016-03-24 11:10:02', '2016-03-24 11:20:02', '2016-03-24 11:30:03', '2016-03-24 11:40:02', '2016-03-24 11:50:02', '2016-03-24 12:00:02', '2016-03-24 12:10:02', '2016-03-24 12:20:02', '2016-03-24 12:30:03', '2016-03-24 12:40:05', '2016-03-24 12:50:02', '2016-03-24 13:00:02', '2016-03-24 13:10:02', '2016-03-24 13:20:02', '2016-03-24 13:30:03', '2016-03-24 13:40:02', '2016-03-24 13:50:02', '2016-03-24 14:00:02', '2016-03-24 14:10:02', '2016-03-24 14:20:02', '2016-03-24 14:30:02', '2016-03-24 14:40:02', '2016-03-24 14:50:02', '2016-03-24 15:00:02', '2016-03-24 15:10:02', '2016-03-24 15:20:02', '2016-03-24 15:30:03', '2016-03-24 15:40:02', '2016-03-24 15:50:02', '2016-03-24 16:00:02', '2016-03-24 16:10:03', '2016-03-24 16:20:01', '2016-03-24 16:30:03', '2016-03-24 16:40:02', '2016-03-24 16:50:02', '2016-03-24 17:00:03', '2016-03-24 17:10:02', '2016-03-24 17:20:02', '2016-03-24 17:30:02', '2016-03-24 17:40:02', '2016-03-24 17:50:02', '2016-03-24 18:00:03', '2016-03-24 18:10:03', '2016-03-24 18:20:02', '2016-03-24 18:30:02', '2016-03-24 18:40:02', '2016-03-24 18:50:02', '2016-03-24 19:00:02', '2016-03-24 19:10:02', '2016-03-24 19:20:02', '2016-03-24 19:30:03', '2016-03-24 19:40:02', '2016-03-24 19:50:02', '2016-03-24 20:00:02', '2016-03-24 20:10:02', '2016-03-24 20:20:03', '2016-03-24 20:30:02', '2016-03-24 20:40:02', '2016-03-24 20:50:01', '2016-03-24 21:00:02', '2016-03-24 21:10:02', '2016-03-24 21:20:03', '2016-03-24 21:30:02', '2016-03-24 21:40:02', '2016-03-24 21:50:02', '2016-03-24 22:00:02', '2016-03-24 22:10:02', '2016-03-24 22:20:02', '2016-03-24 22:30:04', '2016-03-24 22:40:02', '2016-03-24 22:50:02', '2016-03-24 23:00:02', '2016-03-24 23:10:02', '2016-03-24 23:20:03', '2016-03-24 23:30:03', '2016-03-24 23:40:02', '2016-03-24 23:50:01', '2016-03-25 00:00:03', '2016-03-25 00:10:01', '2016-03-25 00:20:02', '2016-03-25 00:30:02', '2016-03-25 00:40:02', '2016-03-25 00:50:02', '2016-03-25 01:00:02', '2016-03-25 01:10:02', '2016-03-25 01:20:02', '2016-03-25 01:30:02', '2016-03-25 01:40:02', '2016-03-25 01:50:02', '2016-03-25 02:00:02', '2016-03-25 02:10:04', '2016-03-25 02:20:03', '2016-03-25 02:30:03', '2016-03-25 02:40:02', '2016-03-25 02:50:02', '2016-03-25 03:00:02', '2016-03-25 03:10:05', '2016-03-25 03:20:02', '2016-03-25 03:30:03', '2016-03-25 03:40:02', '2016-03-25 03:50:02', '2016-03-25 04:00:03', '2016-03-25 04:10:01', '2016-03-25 04:20:02', '2016-03-25 04:30:02', '2016-03-25 04:40:06', '2016-03-25 04:50:02', '2016-03-25 05:00:03', '2016-03-25 05:10:02', '2016-03-25 05:20:02', '2016-03-25 05:30:02', '2016-03-25 05:40:02', '2016-03-25 05:50:02', '2016-03-25 06:00:02', '2016-03-25 06:10:02', '2016-03-25 06:20:02', '2016-03-25 06:30:02', '2016-03-25 06:40:02', '2016-03-25 06:50:02', '2016-03-25 07:00:03', '2016-03-25 07:10:02', '2016-03-25 07:20:02', '2016-03-25 07:30:02', '2016-03-25 07:40:02', '2016-03-25 07:50:02', '2016-03-25 08:00:02', '2016-03-25 08:10:01', '2016-03-25 08:20:02', '2016-03-25 08:30:06', '2016-03-25 08:40:02', '2016-03-25 08:50:02', '2016-03-25 09:00:02', '2016-03-25 09:10:02', '2016-03-25 09:20:02', '2016-03-25 09:30:02', '2016-03-25 09:40:02', '2016-03-25 09:50:02', '2016-03-25 10:00:02', '2016-03-25 14:00:02', '2016-03-25 14:10:02', '2016-03-25 14:20:02', '2016-03-25 14:30:02', '2016-03-25 14:40:02', '2016-03-25 14:50:01', '2016-03-25 15:00:02', '2016-03-25 15:10:02', '2016-03-25 15:20:02', '2016-03-25 15:30:02', '2016-03-25 15:40:02', '2016-03-25 15:50:02', '2016-03-25 16:00:02', '2016-03-25 16:10:02', '2016-03-25 16:20:01', '2016-03-25 16:30:02', '2016-03-25 16:40:02', '2016-03-25 16:50:02', '2016-03-25 17:00:02', '2016-03-28 20:10:02', '2016-03-28 20:20:02', '2016-03-28 20:30:02', '2016-03-28 20:40:02', '2016-03-28 20:50:02', '2016-03-28 21:00:10', '2016-03-28 21:10:07', '2016-03-28 21:20:04', '2016-03-28 21:30:21', '2016-03-28 21:40:02', '2016-03-28 21:50:03', '2016-03-28 22:00:02', '2016-03-28 22:10:04', '2016-03-28 22:20:02', '2016-03-28 22:30:02', '2016-03-28 22:40:02', '2016-03-28 22:50:02', '2016-03-28 23:00:03', '2016-03-28 23:10:02', '2016-03-28 23:20:02', '2016-03-28 23:30:02', '2016-03-28 23:40:02', '2016-03-28 23:50:03', '2016-03-29 00:00:02', '2016-03-29 00:10:01', '2016-03-29 00:20:02', '2016-03-29 00:30:02', '2016-03-29 00:40:02', '2016-03-29 00:50:02', '2016-03-29 01:00:02', '2016-03-29 01:10:02', '2016-03-29 01:20:02', '2016-03-29 01:30:02', '2016-03-29 01:40:02', '2016-03-29 01:50:02', '2016-03-29 02:00:02', '2016-03-29 02:10:03', '2016-03-29 02:20:04', '2016-03-29 02:30:03', '2016-03-29 02:40:04', '2016-03-29 02:50:03', '2016-03-29 03:00:03', '2016-03-29 03:10:03', '2016-03-29 03:20:04', '2016-03-29 03:30:03', '2016-03-29 03:40:02', '2016-03-29 03:50:02', '2016-03-29 04:00:02', '2016-03-29 04:10:02', '2016-03-29 04:20:02', '2016-03-29 04:30:02', '2016-03-29 04:40:02', '2016-03-29 04:50:02', '2016-03-29 05:00:02', '2016-03-29 05:10:02', '2016-03-29 05:20:02', '2016-03-29 05:30:02', '2016-03-29 05:40:01', '2016-03-29 05:50:02', '2016-03-29 06:00:01', '2016-03-29 06:10:02', '2016-03-29 06:20:02', '2016-03-29 06:30:04', '2016-03-29 06:40:02', '2016-03-29 06:50:02', '2016-03-29 07:00:02', '2016-03-29 07:10:02', '2016-03-29 07:20:02', '2016-03-29 07:30:04', '2016-03-29 07:40:02', '2016-03-29 07:50:01', '2016-03-29 08:00:02', '2016-03-29 08:10:03'],
			temperature : [72, 74, 74, 75, 74, 74, 74, 74, 74, 74, 74, 74, 74, 74, 74, 74, 74, 74, 74, 74, 74, 74, 74, 74, 74, 74, 74, 74, 74, 74, 74, 74, 74, 74, 74, 74, 74, 74, 74, 74, 74, 74, 74, 74, 74, 74, 74, 74, 74, 74, 74, 74, 74, 74, 74, 74, 74, 74, 74, 74, 74, 74, 74, 74, 74, 74, 74, 74, 74, 74, 74, 74, 74, 74, 74, 74, 74, 74, 74, 74, 74, 74, 74, 74, 74, 74, 74, 74, 74, 74, 74, 74, 74, 74, 70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 75, 75, 75, 75, 79, 79, 79, 79, 79, 80, 79, 79, 79, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 73, 73, 73, 73, 72, 72, 72, 72, 72, 72, 72, 72, 72, 72, 72, 72, 72, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 70, 70, 70, 70, 69, 69, 69, 69, 69, 69, 69, 69, 69, 69, 69, 70, 69, 69, 70, 70, 70, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71],
			data : []
		},
		graph = {
			scale : {},
			axisPosition : {},
			line : null
		};
	
	// dom
	var $graph;
	
	var methods = {
		/* getXPosition
		*	the scale object will accept a date and calculate the x position
		*/
		getXPosition : function (d) {
			return graph.scale.time(d.date);
		},
		/* getXPosition
		*	the scale object will accept a temperature and calculate the y position
		*/
		getYPosition : function (d) {
			return graph.scale.temp(d.temperature);
		},
		init : function () {
			
			// build the needed structure for D3
			// its easier to get started with associative arrays vs multiple 0 index arrays
			if (options.date.length !== options.temperature.length) {
				if (options.debug) console.log('init: x & y arrays must be of equal length.');
				return false;
			}
			// dateFormatter will format any date that matches the set pattern
			graph.dateFormatter = d3.time.format(options.format);
			if (!options.date.every(function (val, i) { return (options.date[i] = graph.dateFormatter.parse(val)); })) {
				if (options.debug) console.log('something is wrong with the dates', options.date);
				return false;
			}
			for (var i = 0; i < options.date.length; i++) {
				options.data.push({ 'date' : options.date[i], 'temperature' : options.temperature[i] });
			}
			// offset the inner graph so the x/y axis aren't cut-off
			var margin = {
				top : 20,
				right : 20,
				bottom : 30,
				left : 50
			};
			
			// pro-tip: origin is at the top left corner.
			
			// generic scale object
			// data will be plotted to fit this range
			graph.scale.temp = d3.scale.linear().range([options.graphHeight, 0]);
	
			// time scale object
			// data will be plotted to fit this range
			graph.scale.time = d3.time.scale().range([0, options.graphWidth]);
			
			// set the min/max of data that will be used by the scale objects
			graph.scale.time.domain(d3.extent(options.data, function (d) {
				return d.date;
			}));
			graph.scale.temp.domain(d3.extent(options.data, function (d) {
				return d.temperature;
			}));
			
			// attach scale objects to an axis Object
			// and position that axis object
			graph.axisPosition.x = d3.svg.axis()
				.scale(graph.scale.time)
				.orient('bottom');
		
			graph.axisPosition.y = d3.svg.axis()
				.scale(graph.scale.temp)
				.orient('left');
			
			// graph line object
			// calculate the position of the point and
			// tell the line object where it should plot it
			graph.line = d3.svg.line()
				.x(methods.getXPosition)
				.y(methods.getYPosition);
			
			
			// DOM - create the svg that will contain the graph
			// and the element that will draw the graph
			$graph = d3.select('body').append('svg')
			.attr('width', options.graphWidth + margin.left + margin.right)
			.attr('height', options.graphHeight + margin.top + margin.bottom)
			.append('g')
			.attr('transform', 'translate(' + margin.left + ', ' + margin.top + ')');
			
			// DOM - create the elements that will draw the x/y axis
			$graph.append('g')
				.attr('class', 'x axis')
				.attr('transform', 'translate(0, ' + options.graphHeight + ')')
				.call(graph.axisPosition.x);
			$graph.append('g')
				.attr('class', 'y axis')
				.call(graph.axisPosition.y);
			
			// DOM - create the element that will draw the line
			$graph.append('path')
				.datum(options.data)
				.attr('class', 'line')
				.attr('d', graph.line);
		}
	};
	
	
	methods.init();
});
